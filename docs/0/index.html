<!doctype html>
<html>
<head prefix="og: https://ogp.me/ns#">
<meta charset="utf-8">
<title>二重ルビ。</title>
<meta name="description" content="二重ルビ。">
<meta name="author" content="ytyaru">
<link rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/deed.ja">
<link rel="icon" href="../asset/image/author/ytyaru.png">
<meta property="og:type" content="article">
<meta property="og:title" content="二重ルビ。">
<meta property="og:description" content="二重ルビ。">
<meta property="og:url" content="https://ytyaru.github.io/JS.Ruby2.20260117165252/index.html">
<meta property="og:site_name" content="GitHub Pages">
<!--<meta property="og:image" content="https://github.com/ytyaru/JS.Ruby2.20260117165252/blob/master/docs/asset/image/eye-catch.png?raw=true">-->
<link rel="stylesheet" href="css/style.css">
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="../lib/van/1.5.3/nomodule/min.js"></script>
<script src="../js/footer.js"></script>
<script src="../lib/util/type.js"></script>
<script src="../lib/util/test/assertion.js"></script>
<script src="js/main.js"></script>
</head>
<body>
    <!--
    <main></main>
    <footer></footer>
    -->
<div id="content">
  やあ、｜伸縮自在の愛《バンジーガム｜しんしゅくじざいのあい》のような表現や、魔術師《ヒソカ》といった表現が簡単に書けます。
  
  漢字《かんじ》のように冒頭のパイプを省略したり、漢字《｜カンジ》のように下だけに配置することもできます。

  ALPHABET《あふふぁべっと》はパイプないからHTML変換されず、｜ALPHABET《あふふぁべっと》はパイプあるからHTML変換される。

　伸縮自在の愛《バンジーガム｜しんしゅくじざいのあい》は愛の字にルビがかかってしまうが、それが仕様。パイプ省略形と判断されてしまう。

  <!-- 1. 基本（上下両方・上のみ・下のみ） -->
  ｜伸縮自在の愛《バンジーガム｜しんしゅくじざいのあい》
  魔術師《ヒソカ》
  漢字《｜かんじ》

  <!-- 2. パイプ省略（漢字のみ・英数字のみ） -->
  黄金体験《ゴールド・エクスペリエンス｜おうごんたいけん》
  ｜HEAVEN'S DOOR《ヘブンズ・ドアー》
  HEAVEN'S DOOR《ヘブンズ・ドアー》 <!-- 変換されないはず -->

  <!-- 3. エッジケース（記号、短い、長い） -->
  ｜A《｜えー》 <!-- 1文字親文字の下ルビ -->
  佐々木《ささき》 <!-- 踊り字「々」を含む漢字 -->
  阿部ヶ原《あべがはら》 <!-- 「ヶ」を含む漢字 -->
  漢字《……｜！？》 <!-- ルビに記号を含む -->
  ｜あいうえお《アイウエオ》 <!-- ひらがな親文字（｜あり） -->

  <!-- 4. 連続・隣接テスト -->
  漢字《かん》漢字《じ》 <!-- ルビの連続 -->
  （｜親文字《ルビ》） <!-- 括弧との隣接 -->

  <!-- 5. 誤爆防止（変換されないべきもの） -->
  これは《《二重山括弧》》です。 <!-- 親文字が漢字でない・｜なし -->
  名前《 》 <!-- 空ルビ -->
  あいうえお《かきくけこ》 <!-- 非漢字・｜なし -->
</div>

<style>
  /* 上下ルビ表示のためのCSS */
  ruby.under { ruby-position: under; }
  ruby.over { ruby-position: over; }
  #content { line-height: 4.5; font-size: 1.2rem; padding: 2em; }
</style>

<script>
function applyCustomRuby(selector) {
  const container = document.querySelector(selector);
  if (!container) return;

  /**
   * 正規表現の解説:
   * 1. ｜([^｜\n《》]+)《([^》]+)》 : 「｜」から始まる任意の親文字パターン
   * 2. ([\u4E00-\u9FFF々〇ヶ]+)《([^》]+)》 : 「漢字のみ」で始まるパターン
   */
  const rubyRegex = /｜([^｜\n《》]+)《([^》]+)》|([\u4E00-\u9FFF々〇ヶ]+)《([^》]+)》/g;

  container.innerHTML = container.innerHTML.replace(rubyRegex, (match, p1, r1, p2, r2) => {
    // パターン1(p1, r1) か パターン2(p2, r2) のどちらかから親文字とルビを取得
    const parentText = p1 || p2;
    const rubyContent = r1 || r2;

    const parts = rubyContent.split('｜');

    // 下のみ： 《｜下ルビ》 (インデックス0が空文字)
    if (parts.length > 1 && parts[0] === "") {
      const under = parts[1];
      return `<ruby class="under">${parentText}<rt>${under}</rt></ruby>`;
    }
    
    // 上下両方： 《上ルビ｜下ルビ》
    if (parts.length > 1) {
      const over = parts[0];
      const under = parts[1];
      return `<ruby class="under"><ruby class="over">${parentText}<rt>${over}</rt></ruby><rt aria-hidden="true">${under}</rt></ruby>`;
    }

    // 上のみ： 《上ルビ》
    return `<ruby class="over">${parentText}<rt>${rubyContent}</rt></ruby>`;
  });
}

// 実行
applyCustomRuby('#content');
</script>



</body>
</html>
<!-- https://coliss.com/articles/build-websites/operation/work/html-template-for-web-apps-or-sites.html -->
<!-- https://coliss.com/articles/build-websites/operation/work/html5-template-for-2018.html -->
